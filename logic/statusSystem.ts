
import { GameState } from '../types';

/**
 * 根据当前游戏状态（数值、天数、时段）返回地图选择页面的感官描述。
 */
export const getLocalStatusSummary = (state: GameState): string => {
  const { stats, day, timeOfDay, statusFlags } = state;

  // --- 0. 特殊时段覆盖 ---
  if (day === 1) {
    return "30天。3万块。这是刀哥给你的死刑倒计时。你看着手里碎屏的手机，不知道哪一条路能通向活路。";
  }
  if (day === 20 && !statusFlags.isMotherDead) {
    return "医院的消毒水味似乎飘到了这里。如果今天筹不到手术费，这张地图上就只剩你一个人了。";
  }
  if (day === 29) {
    return "最后24小时。所有的账，无论是钱还是命，都要在今晚结清。黑岭镇很安静，像是在等待一场雪崩。";
  }

  // --- 1. 濒死 / 崩溃层 ---
  if (stats.stamina < 10) {
    return "肺里像是塞满了烧红的煤渣，每一次呼吸都带着铁锈味。视线开始模糊了……如果不找个地方躺下，这可能就是最后一次看这张地图。";
  }
  if (stats.mood < 10) {
    if (stats.sin > 5) {
      return "那些建筑……它们在呼吸。学校的窗户像是无数只眼睛死死盯着你。刀哥的笑声就在耳边，但他明明不在这一带。必须找个地方躲起来。";
    } else {
      return "谁在说话？闭嘴。地图上的字都在跳舞。我不记得我要去哪了，或许跳进矿坑里是个好主意？那里看起来暖和极了。";
    }
  }

  // --- 2. 肮脏 / 羞耻层 ---
  if (stats.hygiene < 20) {
    return "路过的人都在捂着鼻子躲避你。你低头看了看满是油污的袖口，身上那股酸臭味让你在寒风中也感到燥热。没人会欢迎现在的你。";
  }

  // --- 3. 赤贫 / 饥饿层 ---
  if (stats.money < 50 && stats.debt > 0) {
    if (stats.satiety < 30) {
      return "胃里空得像个无底洞，胃酸在烧。兜里只剩下几个硬币，碰得叮当响。你是去买个馒头续命，还是留着最后一点钱去碰碰运气？";
    }
    return "手机又震动了，不用看也知道是催债的。地图上每一个地点都像是一个可能的提款机，或者坟墓。只要能搞到钱，做什么都行。";
  }

  // --- 4. 堕落 / 暴富层 (移除心计逻辑) ---
  if (stats.sin > 6 && stats.money > 5000) {
    if (state.currentArea === 'PROVINCIAL_CAPITAL') {
      return "黑岭太小了。省城的灯红酒绿才是你应该去的地方。至于那些还在死读书的傻瓜……让他们烂在泥里吧。";
    }
    return "手里沉甸甸的现金让你感到前所未有的温暖。曾经让你害怕的地方，现在你只觉得可笑。只要钱到位，黑岭镇也是天堂。";
  }

  // --- 5. 做题家 / 麻木层 ---
  if (stats.academic > 80 && stats.mood < 40) {
    return "周围的喧嚣仿佛被隔绝在一层玻璃之外。那些为了几百块钱打架的人真可悲。只要考出去……只要考出去，这一切就结束了。对吧？";
  }

  // --- 6. 常态 / 迷茫层 ---
  switch (timeOfDay) {
    case 'MORNING':
    case 'FORENOON':
      return "天还没亮透，煤烟味就已经呛进了喉咙。黑岭镇醒了，像一只巨大的灰色野兽。今天该去哪找点希望？";
    case 'AFTERNOON':
    case 'DUSK':
      return "夕阳把雪地染成了血红色。一天又要过去了，距离那个审判日又近了一步。你站在路口，犹豫不决。";
    case 'NIGHT':
    case 'MIDNIGHT':
      return "街上没人了，只有红太阳舞厅的灯还在闪。风像刀子一样刮脸。回家睡觉是唯一的免费选项，但你真的睡得着吗？";
    default:
      return "你站在小镇的废墟边缘，风中带着铁锈和绝望。这里的生存法则从未改变：忍耐，或者崩坏。";
  }
};
